{"ast":null,"code":"var _jsxFileName = \"/Users/igorfesenko/Desktop/xray-editor/src/ImageViewer/ImageViewer.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport './ImageViewer.css';\nimport SideToolbar from '../SideToolbar/SideToolbar';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction ImageViewer({\n  image,\n  onClose\n}) {\n  _s();\n  const canvasRef = useRef(null);\n  const [brightness, setBrightness] = useState(0);\n  const [contrast, setContrast] = useState(0);\n  const [initialBrightness, setInitialBrightness] = useState(0);\n  const [initialContrast, setInitialContrast] = useState(0);\n  const [scale, setScale] = useState(1);\n  const [positionX, setPositionX] = useState(0);\n  const [positionY, setPositionY] = useState(0);\n  useEffect(() => {\n    if (!image) return;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext('2d');\n    const img = new Image();\n    img.onload = () => {\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0);\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const data = imageData.data;\n      let totalBrightness = 0;\n      let totalContrast = 0;\n      for (let i = 0; i < data.length; i += 4) {\n        totalBrightness += data[i];\n        totalBrightness += data[i + 1];\n        totalBrightness += data[i + 2];\n      }\n      setInitialBrightness(totalBrightness / (data.length / 4) * 100 / 765); // Normalize to -100 to 100 range\n      setBrightness(initialBrightness);\n      setInitialContrast(0); // Initialize contrast to 0\n      setContrast(initialContrast);\n      applyFilters(ctx);\n    };\n    img.src = URL.createObjectURL(image);\n  }, [image]);\n  const applyFilters = ctx => {\n    if (!ctx) return;\n    const imageData = ctx.getImageData(0, 0, canvasRef.current.width, canvasRef.current.height);\n    const data = imageData.data;\n    const factorBrightness = (brightness + 100) / 100; // Convert brightness to a factor\n    const factorContrast = (contrast + 100) / 100; // Convert contrast to a factor\n\n    for (let i = 0; i < data.length; i += 4) {\n      // Apply brightness and contrast adjustment to each pixel\n      data[i] = factorContrast * (data[i] - 128) + 128 + brightness;\n      data[i + 1] = factorContrast * (data[i + 1] - 128) + 128 + brightness;\n      data[i + 2] = factorContrast * (data[i + 2] - 128) + 128 + brightness;\n    }\n    ctx.putImageData(imageData, 0, 0);\n  };\n  const handleBrightnessChange = value => {\n    setBrightness(value);\n    applyFilters(canvasRef.current.getContext('2d'));\n  };\n  const handleContrastChange = value => {\n    setContrast(value);\n    applyFilters(canvasRef.current.getContext('2d'));\n  };\n  const handleSave = () => {\n    const canvas = canvasRef.current;\n    const modifiedImage = canvas.toDataURL();\n    onClose(modifiedImage);\n  };\n  const handleZoomIn = () => {\n    setScale(scale + 0.1);\n  };\n  const handleZoomOut = () => {\n    if (scale > 0.1) {\n      setScale(scale - 0.1);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"image-viewer\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleZoomIn,\n        children: \"Zoom In\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleZoomOut,\n        children: \"Zoom Out\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onClose,\n        children: \"Close\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      className: \"canvas\",\n      style: {\n        transform: `scale(${scale}) translate(${positionX}px, ${positionY}px)`,\n        cursor: 'grab'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(SideToolbar, {\n      initialBrightness: initialBrightness,\n      initialContrast: initialContrast,\n      onBrightnessChange: handleBrightnessChange,\n      onContrastChange: handleContrastChange,\n      onSave: handleSave\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 92,\n    columnNumber: 9\n  }, this);\n}\n_s(ImageViewer, \"zB82Lo1Nf7KO6zMnQdtmV4ygpK0=\");\n_c = ImageViewer;\nexport default ImageViewer;\nvar _c;\n$RefreshReg$(_c, \"ImageViewer\");","map":{"version":3,"names":["React","useState","useEffect","useRef","SideToolbar","jsxDEV","_jsxDEV","ImageViewer","image","onClose","_s","canvasRef","brightness","setBrightness","contrast","setContrast","initialBrightness","setInitialBrightness","initialContrast","setInitialContrast","scale","setScale","positionX","setPositionX","positionY","setPositionY","canvas","current","ctx","getContext","img","Image","onload","width","height","drawImage","imageData","getImageData","data","totalBrightness","totalContrast","i","length","applyFilters","src","URL","createObjectURL","factorBrightness","factorContrast","putImageData","handleBrightnessChange","value","handleContrastChange","handleSave","modifiedImage","toDataURL","handleZoomIn","handleZoomOut","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","ref","style","transform","cursor","onBrightnessChange","onContrastChange","onSave","_c","$RefreshReg$"],"sources":["/Users/igorfesenko/Desktop/xray-editor/src/ImageViewer/ImageViewer.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport './ImageViewer.css';\nimport SideToolbar from '../SideToolbar/SideToolbar';\n\nfunction ImageViewer({ image, onClose }) {\n    const canvasRef = useRef(null);\n    const [brightness, setBrightness] = useState(0);\n    const [contrast, setContrast] = useState(0);\n    const [initialBrightness, setInitialBrightness] = useState(0);\n    const [initialContrast, setInitialContrast] = useState(0);\n    const [scale, setScale] = useState(1);\n    const [positionX, setPositionX] = useState(0);\n    const [positionY, setPositionY] = useState(0);\n\n    useEffect(() => {\n        if (!image) return;\n\n        const canvas = canvasRef.current;\n        const ctx = canvas.getContext('2d');\n\n        const img = new Image();\n        img.onload = () => {\n            canvas.width = img.width;\n            canvas.height = img.height;\n            ctx.drawImage(img, 0, 0);\n            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n            const data = imageData.data;\n            let totalBrightness = 0;\n            let totalContrast = 0;\n            for (let i = 0; i < data.length; i += 4) {\n                totalBrightness += data[i];\n                totalBrightness += data[i + 1];\n                totalBrightness += data[i + 2];\n            }\n            setInitialBrightness((totalBrightness / (data.length / 4)) * 100 / 765); // Normalize to -100 to 100 range\n            setBrightness(initialBrightness);\n            setInitialContrast(0); // Initialize contrast to 0\n            setContrast(initialContrast);\n            applyFilters(ctx);\n        };\n        img.src = URL.createObjectURL(image);\n    }, [image]);\n\n    const applyFilters = (ctx) => {\n        if (!ctx) return;\n\n        const imageData = ctx.getImageData(0, 0, canvasRef.current.width, canvasRef.current.height);\n        const data = imageData.data;\n\n        const factorBrightness = (brightness + 100) / 100; // Convert brightness to a factor\n        const factorContrast = (contrast + 100) / 100; // Convert contrast to a factor\n\n        for (let i = 0; i < data.length; i += 4) {\n            // Apply brightness and contrast adjustment to each pixel\n            data[i] = factorContrast * (data[i] - 128) + 128 + brightness;\n            data[i + 1] = factorContrast * (data[i + 1] - 128) + 128 + brightness;\n            data[i + 2] = factorContrast * (data[i + 2] - 128) + 128 + brightness;\n        }\n\n        ctx.putImageData(imageData, 0, 0);\n    };\n\n\n\n    const handleBrightnessChange = (value) => {\n        setBrightness(value);\n        applyFilters(canvasRef.current.getContext('2d'));\n    };\n\n    const handleContrastChange = (value) => {\n        setContrast(value);\n        applyFilters(canvasRef.current.getContext('2d'));\n    };\n\n    const handleSave = () => {\n        const canvas = canvasRef.current;\n        const modifiedImage = canvas.toDataURL();\n        onClose(modifiedImage);\n    };\n\n    const handleZoomIn = () => {\n        setScale(scale + 0.1);\n    };\n\n    const handleZoomOut = () => {\n        if (scale > 0.1) {\n            setScale(scale - 0.1);\n        }\n    };\n\n    return (\n        <div className=\"image-viewer\">\n            <div className=\"controls\">\n                <button onClick={handleZoomIn}>Zoom In</button>\n                <button onClick={handleZoomOut}>Zoom Out</button>\n                <button onClick={onClose}>Close</button>\n            </div>\n            <canvas\n                ref={canvasRef}\n                className=\"canvas\"\n                style={{\n                    transform: `scale(${scale}) translate(${positionX}px, ${positionY}px)`,\n                    cursor: 'grab',\n                }}\n            />\n            <SideToolbar\n                initialBrightness={initialBrightness}\n                initialContrast={initialContrast}\n                onBrightnessChange={handleBrightnessChange}\n                onContrastChange={handleContrastChange}\n                onSave={handleSave}\n            />\n        </div>\n    );\n}\n\nexport default ImageViewer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}